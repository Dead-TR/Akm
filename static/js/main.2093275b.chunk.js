(this.webpackJsonpakm=this.webpackJsonpakm||[]).push([[0],{21:function(t,e,a){},24:function(t,e,a){},25:function(t,e,a){"use strict";a.r(e);var i=a(6),n=a(16),r=(a(21),a(7)),o=a.n(r),s=a(1),c=a(2),h=a(3),l=a(13),m=a(9),d=a(8),u=a(14),y=a(4),p=a(11),v={health:16711680},f={health:{width:30,height:5}},b=function(){function t(e,a,i,n,r,o){var h;(Object(c.a)(this,t),this.actor=void 0,this.scene=void 0,this.animations=void 0,this.params={health:100,armor:10,attack:10,speed:100,coolDown:5},this.elements={healthLine:null},this.mortal={sword:null,enemy:null,target:{},fight:{health:100,coolDown:50}},this.collision={top:{calc:-15,blocked:!1},bottom:{calc:15,blocked:!1},left:{calc:-15,blocked:!1},right:{calc:15,blocked:!1}},this.scene=e,this.actor=e.physics.add.sprite(a,i,n,r),o.origin)&&(h=this.actor).setOrigin.apply(h,Object(s.a)(o.origin))}return Object(h.a)(t,[{key:"setDeath",value:function(){var t,e;null===(t=this.mortal.sword)||void 0===t||t.destroy(),this.actor.x=-1e3,this.actor.destroy(),null===(e=this.elements.healthLine)||void 0===e||e.destroy(),this.mortal.enemy&&(this.mortal.enemy.mortal.enemy=null)}},{key:"mortalAnimationPlay",value:function(t){!this.animations||this.mortal.fight.health<=0||(t?this.mortal.sword&&this.mortal.sword.active?(this.mortal.sword.x=this.actor.x,this.mortal.sword.y=this.actor.y,this.mortal.sword.setDepth(this.actor.depth+1)):(this.mortal.sword=this.scene.add.sprite(this.actor.x,this.actor.y,"").setOrigin(this.actor.originX,this.actor.originY),this.mortal.sword.play(this.animations.sword)):this.mortal.sword&&(this.mortal.sword.destroy(),this.mortal.sword=null))}},{key:"mortalCalculate",value:function(t){if(t&&!(this.mortal.fight.health<=0)){if(this.elements.healthLine){var e=this.mortal.fight.health/this.params.health;this.elements.healthLine.scaleX=e}if(this.mortal.fight.coolDown===this.params.coolDown){this.mortal.fight.coolDown--;var a=this.params.attack-t.params.armor;t.mortal.fight.health-=a>0?a:0}else this.mortal.fight.coolDown--,this.mortal.fight.coolDown<0&&(this.mortal.fight.coolDown=this.params.coolDown);var i;if(t.mortal.fight.health<=0)t.setDeath(),this.mortal.enemy=null,null===(i=this.mortal.sword)||void 0===i||i.destroy(),this.mortal.sword=null}}},{key:"checkCollision",value:function(t,e,a){for(var i=this,n=function(){var n,s=Object(p.a)(o[r],2),c=s[0],h=s[1],l="top"===c||"bottom"===c?"y":"x",m={x:"x"===l?i.actor.x+h.calc:i.actor.x,y:"y"===l?i.actor.y+h.calc:i.actor.y},d=null===(n=t.getTileAtWorldXY(m.x,m.y,!1))||void 0===n?void 0:n.index,u=e.indexOf(d||0);h.blocked=!u||-1!==u,a&&a.characters&&a.characters.forEach((function(t){if(t.actor!==i.actor&&t.actor.active){var e=t.actor.x<=m.x+7&&t.actor.x>=m.x-7,a=t.actor.y<=m.y+7&&t.actor.y>=m.y-7;e&&a&&(h.blocked||(h.blocked=!0))}}))},r=0,o=Object.entries(this.collision);r<o.length;r++)n()}},{key:"createCollision",value:function(t){this.collision.right.blocked?t.direction.x>0&&(t.coordinates.x=this.actor.x):this.collision.left.blocked&&t.direction.x<0&&(t.coordinates.x=this.actor.x),this.collision.bottom.blocked?t.direction.y>0&&(t.coordinates.y=this.actor.y):this.collision.top.blocked&&t.direction.y<0&&(t.coordinates.y=this.actor.y)}},{key:"move",value:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;if(this.elements.healthLine&&(this.elements.healthLine.x=this.actor.x,this.elements.healthLine.y=this.actor.y),this.mortal.fight.health<=0)return["stop","stop"];var n=this.actor.x-t<-i?"right":this.actor.x-t>i?"left":"stop",r=this.actor.y-e<-i?"bottom":this.actor.y-e>i?"top":"stop";return"right"===n?this.actor.setVelocityX(a):"left"===n?this.actor.setVelocityX(-a):this.actor.setVelocityX(0),"bottom"===r?this.actor.setVelocityY(a):"top"===r?this.actor.setVelocityY(-a):this.actor.setVelocityY(0),[n,r]}},{key:"createHealth",value:function(){var t=this.scene.add.graphics({x:this.actor.x,y:this.actor.y});t.lineStyle(f.health.height,v.health);var e=-1*f.health.height-this.actor.height*this.actor.originY;t.beginPath(),t.moveTo(f.health.width/2*-1,e),t.lineTo(f.health.width/2,e),t.closePath(),t.strokePath(),t.setDepth(this.actor.depth+2),this.elements.healthLine=t}},{key:"movementAnimation",value:function(t,e){if(e&&!(this.mortal.fight.health<=0))try{var a,i=Object(p.a)(t,2),n=i[0],r=i[1];if("stop"!==n)this.actor.anims.isPaused&&this.actor.anims.play(this.actor.anims.currentAnim),(null===(a=this.actor.anims.currentAnim)||void 0===a?void 0:a.key)!==e[n]&&this.actor.anims.play(e[n]);else if("stop"!==r){var o;this.actor.anims.isPaused&&this.actor.anims.play(this.actor.anims.currentAnim),(null===(o=this.actor.anims.currentAnim)||void 0===o?void 0:o.key)!==e[r]&&this.actor.anims.play(e[r])}else{var s;this.actor.anims.pause(null===(s=this.actor.anims.currentAnim)||void 0===s?void 0:s.frames[1])}}catch(c){this.actor.anims.pause()}}}]),t}();function g(t,e,a,i,n,r){return new w(this,t,e,a,i,n,r)}var w=function(t){Object(m.a)(a,t);var e=Object(d.a)(a);function a(t,i,n,r,o,s,h){var l;return Object(c.a)(this,a),(l=e.call(this,t,i,n,r,o,{origin:null===h||void 0===h?void 0:h.origin,animations:s})).scene=void 0,l.visionDistance=100,l.animations=void 0,l.scene=t,l.visionDistance=(null===h||void 0===h?void 0:h.vision)||l.visionDistance,l.animations=s,(null===h||void 0===h?void 0:h.char)&&(l.params=h.char),l.createHealth(),l}return Object(h.a)(a,[{key:"watching",value:function(t,e){var i=this,n=void 0;if(n||(n=t.find((function(t){var e=Math.abs(t.actor.x-i.actor.x),a=Math.abs(t.actor.y-i.actor.y);return e<i.visionDistance&&a<i.visionDistance}))),n){this.visionDistance=1/0;var r={direction:{x:n.actor.x-this.actor.x,y:n.actor.y-this.actor.y},coordinates:{x:n.actor.x,y:n.actor.y}};e&&(this.checkCollision(this.scene.world.world,e,{characters:this.scene.enemy}),this.createCollision(r));var o=Object(u.a)(Object(y.a)(a.prototype),"move",this).call(this,r.coordinates.x,r.coordinates.y,this.params.speed,15);if(this.animations.movement){var s=this.animations.movement;this.movementAnimation(o,s)}var c,h=Math.abs(r.direction.x)<=14&&Math.abs(r.direction.y)<=14;if(this.mortalAnimationPlay(h),h)this.mortalCalculate(n),n.mortal.enemy||(n.mortal.enemy=this);else(null===(c=n.mortal.enemy)||void 0===c?void 0:c.actor)===this.actor&&(n.mortal.enemy=null)}}}]),a}(b);function j(t,e,a,i,n){return new O(this,t,e,a,i,n)}var O=function(t){Object(m.a)(a,t);var e=Object(d.a)(a);function a(t,i,n,r,o,s){var h,l;return Object(c.a)(this,a),(l=e.call(this,t,i,n,r,o,{origin:null===s||void 0===s?void 0:s.origin,animations:s.animation})).scene=void 0,l.inventory=void 0,l.scene=t,l.animations=s.animation,l.params={health:100,armor:999999999999999,attack:11,coolDown:0,speed:100},l.inventory=t.engine.create.inventory({img:"uiInventory"}),(null===(h=l.scene.engine.layers)||void 0===h?void 0:h.ui)&&l.inventory.elements.uiButton&&l.scene.engine.layers.ui.add(l.inventory.elements.uiButton),l}return Object(h.a)(a,[{key:"move",value:function(t,e,i){var n;this.checkCollision(e,i);var r={direction:{x:t.x-this.actor.x,y:t.y-this.actor.y},coordinates:{x:t.x,y:t.y}};this.createCollision(r);var o=Object(u.a)(Object(y.a)(a.prototype),"move",this).call(this,r.coordinates.x,r.coordinates.y,this.params.speed,5);return this.movementAnimation(o,null===(n=this.animations)||void 0===n?void 0:n.movement),this.mortalAnimationPlay(!!this.mortal.enemy),this.mortal.enemy&&this.mortalCalculate(this.mortal.enemy),o}}]),a}(b);function x(t,e,a,i){var n=this.make.tilemap({key:e,tileHeight:i,tileWidth:i}),r=t?n.addTilesetImage(a,void 0,i,i):null;return n.createStaticLayer(0,r,0,0)}var k=function(){function t(e,a,i,n,r){Object(c.a)(this,t),this.world=void 0,this.scene=void 0,this.objects=void 0,this.scene=e,this.world=x.call(e,a,i,n,r),this.objects={}}return Object(h.a)(t,[{key:"addSimpleObjects",value:function(t){var e=this;t.forEach((function(t){var a=t.x,i=t.y,n=t.imgName,r=t.name;e.objects[r]=e.scene.add.image(a,i,n)}))}}]),t}();function D(t,e,a,i){return new k(this,t,e,a,i)}var I=a(0),B=[{img:"inventoryElement_1",name:"item",slot:"body",price:10},{img:"inventoryElement_2",name:"item2",slot:"arm",price:10}];function L(t,e,a){var i=t.add.graphics();return i.lineStyle(2,1150643),i.strokeRect(0,0,40,40),i.x=e,i.y=a,i}function S(t,e,a){for(var i=[],n=function(n){if(n>e.length-1)return"break";var r=a[n],o={x:e[n].x+3,y:e[n].y+3},s=t.add.sprite(o.x,o.y,r.img).setOrigin(0,0).setScrollFactor(0).setInteractive().on("pointerdown",(function(){console.log("item click",r.img,n)}));s.params=r,i.push(s)},r=0;r<a.length;r++){if("break"===n(r))break}return i}var z=function(t){t.forEach((function(t){t.destroy()})),t.length=0};function A(t){return new _(this,t)}var _=function(){function t(e,a){var i=this;Object(c.a)(this,t),this.scene=void 0,this.elements=void 0,this.list=[],this.inventoryStatus="close",this.allItems=B.map((function(t,e){return Object(I.a)(Object(I.a)({},t),{},{id:e})})),this.cells=void 0,this.inventoryContainer=void 0,this.displayedItems=void 0,this.barterButton=void 0,this.scene=e,this.list[0]=this.list[1]=this.list[2]=this.allItems[0],this.inventoryContainer=e.add.container(0,0).setScrollFactor(0);var n={w:Number(e.game.config.width),h:Number(e.game.config.height)},r=e.make.graphics({}),o=r.createGeometryMask(),h=this.inventoryContainer,l=e.add.sprite(n.w/2,n.h/2,"inventoryBG").setOrigin(.5).setInteractive().on("pointerdown",(function(){return null}));this.cells=function(t){for(var e=[],a=0,i=1;i<=40;i++){var n=50;switch(i%5){case 1:n*=1,a++;break;case 0:n*=5;break;default:n*=i%5}e.push(L(t,n,50*a))}return e}(e),this.barterButton=function(t,e){var a=Number(t.game.config.width)-50;return t.add.sprite(a,100,"barterButton").setInteractive()}(e).setAlpha(0),r.fillRect(15,15,n.w-30,n.h-30).setScrollFactor(0),h.add([l].concat(Object(s.a)(this.cells))).setMask(o).setAlpha(0),this.elements={background:l,container:h,mask:o},this.elements.uiButton=e.add.sprite(n.w,0,a.img),this.elements.uiButton.setOrigin(1,0).setScrollFactor(0).setInteractive(),this.elements.uiButton.on("pointerdown",(function(){switch(i.inventoryStatus){case"close":i.openInventory();break;case"open":case"barter":i.closeInventory()}}))}return Object(h.a)(t,[{key:"openInventory",value:function(){this.inventoryStatus="open",this.displayedItems=S(this.scene,this.cells,this.list),this.inventoryContainer.add(Object(s.a)(this.displayedItems)),this.elements.container.setAlpha(1)}},{key:"openBarter",value:function(t){var e=this,a="box";this.inventoryStatus="barter",this.displayedItems=S(this.scene,this.cells,t),this.barterButton.setAlpha(1),this.barterButton.setDepth(this.inventoryContainer.length).on("pointerup",(this.scene,function(){switch(console.log("click"),a){case"player":z(e.displayedItems),e.displayedItems=S(e.scene,e.cells,t),e.inventoryContainer.add(Object(s.a)(e.displayedItems)),a="box";break;case"box":z(e.displayedItems),e.displayedItems=S(e.scene,e.cells,e.list),e.inventoryContainer.add(Object(s.a)(e.displayedItems)),a="player"}})),this.inventoryContainer.add(Object(s.a)(this.displayedItems)),this.elements.container.setAlpha(1)}},{key:"closeInventory",value:function(){this.inventoryStatus="close",z(this.displayedItems),this.barterButton.setAlpha(0),this.elements.container.setAlpha(0)}},{key:"createBox",value:function(t,e,a,i){var n=this,o=[];if(i){var s=i.random,c=i.search;if(s)for(var h=0;h<s;h++){var l=this.allItems[r.Math.Between(0,this.allItems.length-1)];o.push(l)}c&&c.forEach((function(t){var e=n.allItems[t];o.push(e)}))}var m=this.scene.add.sprite(t,e,a).setInteractive().on("pointerdown",(function(){Math.abs(n.scene.player.actor.x-m.x)<60&&Math.abs(n.scene.player.actor.y-m.y)<60&&!n.scene.player.mortal.enemy&&n.openBarter(o)}));return{img:m,list:o}}}]),t}();function E(t){var e=this;t.forEach((function(t){var a=t.key,i=t.frame;e.anims.create({key:a,frames:e.anims.generateFrameNumbers(i.name,i.ways),frameRate:i.frameRate,repeat:i.repeat})}))}function C(t,e){var a=this.cameras.main;return a.setBounds(0,0,Number(e.width),Number(e.height)).startFollow(t,!0,1,1,0,0),a}function F(t,e,a,i,n,r,o){var s=this,c=this.add.circle(t,e,a,n);if(r){var h=r.color,l=r.size;c.setStrokeStyle(l,h)}var m=this.tweens.add({delay:.1,targets:c,scale:i,yoyo:!1,repeat:0,alpha:0,ease:"Sine.easeInOut"});return this.input.on("pointerdown",(function(t,e){if(!e.length){var a=0,i=0;o&&(a=o.scrollX,i=o.scrollY),c.x=s.input.x+a,c.y=s.input.y+i,m.restart()}})),c}function G(t){var e=this;t.forEach((function(t){var a=t.method;t.data.forEach((function(t){var i;(i=e.load)[a].apply(i,Object(s.a)(t))}))}))}function R(t){Object(s.a)(t).sort((function(t,e){return t.actor.y-e.actor.y})).forEach((function(t,e){var a;t.actor.setDepth(e),null===(a=t.elements.healthLine)||void 0===a||a.setDepth(e+1)}))}function H(){return{ui:this.add.layer().setDepth(2),gameElements:{characters:this.add.layer().setDepth(1)}}}function U(t,e){t.forEach((function(t){var a=t.actor,i=t.elements;e.add(a),(null===i||void 0===i?void 0:i.healthLine)&&e.add(i.healthLine)}))}function M(t,e){var a=[];Array.isArray(t)?a.push.apply(a,Object(s.a)(t)):a.push(t),a.forEach((function(t){return e.add(t)}))}var P=function(){function t(e){Object(c.a)(this,t),this.scene=void 0,this.load=void 0,this.create=void 0,this.update=void 0,this.layers=void 0,this.scene=e,this.load={preload:G.bind(this.scene),animation:E.bind(this.scene)},this.create={world:D.bind(this.scene),player:j.bind(this.scene),enemy:g.bind(this.scene),animation:E.bind(this.scene),camera:C.bind(this.scene),inventory:A.bind(this.scene),layers:H.bind(this.scene),addToLayer:{characters:U.bind(this.scene),sprites:M.bind(this.scene)},ui:{cursor:F.bind(this.scene)}},this.update={check:{characterZIndex:R.bind(this.scene)}}}return Object(h.a)(t,[{key:"addListeners",value:function(t,e){this.scene.input.on(t,e)}}]),t}();var T={ways:{start:0,end:3},frameRate:6,repeat:-1},N={ways:{start:0,end:22},frameRate:15,repeat:-1},W=[{key:"playerGoUp",frame:Object(I.a)(Object(I.a)({},T),{},{name:"playerUp"})},{key:"playerGoDown",frame:Object(I.a)(Object(I.a)({},T),{},{name:"playerDown"})},{key:"playerGoLeft",frame:Object(I.a)(Object(I.a)({},T),{},{name:"playerLeft"})},{key:"playerGoRight",frame:Object(I.a)(Object(I.a)({},T),{},{name:"playerRight"})},{key:"zombieU",frame:Object(I.a)(Object(I.a)({},T),{},{name:"zombieUp"})},{key:"zombieD",frame:Object(I.a)(Object(I.a)({},T),{},{name:"zombieDown"})},{key:"zombieL",frame:Object(I.a)(Object(I.a)({},T),{},{name:"zombieLeft"})},{key:"zombieR",frame:Object(I.a)(Object(I.a)({},T),{},{name:"zombieRight"})},{key:"clawsFight",frame:Object(I.a)(Object(I.a)({},N),{},{name:"claws"})},{key:"sword_1Fight",frame:Object(I.a)(Object(I.a)({},N),{},{name:"sword_1"})}],V=[0,2,3,4,5,7,8,9,10],X=[{name:"zombie",config:{x:250,y:510,spriteSheet:"zombieDown",textureFrame:1,origin:[.5,.8]},animations:{movement:{top:"zombieU",bottom:"zombieD",left:"zombieL",right:"zombieR"},sword:"clawsFight"}}];var Y=[],J={frame:{frameWidth:20,frameHeight:45,startFrame:0,endFrame:3},player:"game/assets/img/DefaultScene/characters/player/",zombie:"game/assets/img/DefaultScene/characters/enemies/zombie/"},Z={path:"".concat("game/assets/img/DefaultScene/effects/","fight/"),claws:{name:"claws.png",frame:{frameWidth:80,frameHeight:80,startFrame:0,endFrame:22}},sword_1:{name:"sword_1.png",frame:{frameWidth:80,frameHeight:80,startFrame:0,endFrame:23}}},q="game/assets/",K=[{method:"image",data:[["exampleGrassTile",q+"img/DefaultScene/grass.png"],["cursor",q+"img/general/cursor.png"],["empty",q+"img/general/emptyLayers.png"],["uiInventory",q+"img/general/ui/inventory.png"],["inventoryBG",q+"img/general/ui/inventoryBG.png"],["inventoryElement_1",q+"img/general/items/body/1.png"],["inventoryElement_2",q+"img/general/items/arm/1.png"],["inventoryBox",q+"img/general/items/box.png"],["barterButton",q+"img/general/b_button.png"]]},{method:"tilemapCSV",data:[["exampleGrid",q+"grids/DefaultScene/grass.csv"]]},{method:"spritesheet",data:[["playerLeft","".concat(J.player,"p_left.png"),J.frame],["playerRight","".concat(J.player,"p_right.png"),J.frame],["playerDown","".concat(J.player,"p_down.png"),Object(I.a)(Object(I.a)({},J.frame),{},{frameHeight:44})],["playerUp","".concat(J.player,"p_up.png"),Object(I.a)(Object(I.a)({},J.frame),{},{frameHeight:44,frameWidth:19})],["zombieLeft","".concat(J.zombie,"p_left.png"),Object(I.a)(Object(I.a)({},J.frame),{},{frameHeight:41,frameWidth:22})],["zombieRight","".concat(J.zombie,"p_right.png"),Object(I.a)(Object(I.a)({},J.frame),{},{frameHeight:41,frameWidth:22})],["zombieUp","".concat(J.zombie,"p_up.png"),J.frame],["zombieDown","".concat(J.zombie,"p_down.png"),J.frame],["claws","".concat(Z.path).concat(Z.claws.name),Z.claws.frame],["sword_1","".concat(Z.path).concat(Z.sword_1.name),Z.sword_1.frame]]}],Q=function(t){Object(m.a)(a,t);var e=Object(d.a)(a);function a(t){var i;return Object(c.a)(this,a),(i=e.call(this,t)).engine=void 0,i.player=void 0,i.world=void 0,i.enemy=[],i.state=void 0,i.engine=new P(Object(l.a)(i)),i.state={},i}return Object(h.a)(a,[{key:"preload",value:function(){this.engine.load.preload(K)}},{key:"create",value:function(){var t;this.engine.layers=this.engine.create.layers(),this.engine.load.animation(W),this.world=this.engine.create.world(!0,"exampleGrid","exampleGrassTile",32),this.world.addSimpleObjects(Y),this.player=this.engine.create.player(64,64,"playerUp",1,{origin:[.5,.8],animation:{movement:{left:"playerGoLeft",right:"playerGoRight",top:"playerGoUp",bottom:"playerGoDown"},sword:"sword_1Fight"},inventory:"uiInventory"}),this.player.inventory.createBox(300,100,"inventoryBox",{random:2}),t=this,X.forEach((function(e){e.name;var a=e.config,i=e.animations;t.enemy.push(t.engine.create.enemy(a.x,a.y,a.spriteSheet,a.textureFrame,i,{origin:a.origin,vision:150,speed:100}))})),this.state.camera=this.engine.create.camera(this.player.actor,this.world.world),this.state.cursor=this.engine.create.ui.cursor(100,100,1,25,16777215,null,this.state.camera),this.engine.addListeners("pointerup",(function(){})),function(t){var e=t.engine.create.addToLayer;t.engine.layers&&(e.characters([].concat(Object(s.a)(t.enemy),[t.player]),t.engine.layers.gameElements.characters),e.sprites(function(t){var e=[t.player.inventory.elements.container];t.player.inventory.elements.uiButton&&e.push(t.player.inventory.elements.uiButton);for(var a=0;a<e.length;a++)e[a].setDepth(a);return e}(t),t.engine.layers.ui))}(this)}},{key:"update",value:function(){this.player.move(this.state.cursor,this.world.world,V),this.engine.update.check.characterZIndex([this.player].concat(Object(s.a)(Object.values(this.enemy)))),function(t){for(var e=0,a=Object.entries(t.enemy);e<a.length;e++){var i=Object(p.a)(a[e],2);i[0],i[1].watching([t.player],V)}}(this),this.enemy.filter((function(t){return t.mortal.fight.health>=0}))}}]),a}(r.Scene),$={type:Phaser.AUTO,parent:"game-box",width:480,height:480,scene:[Q],backgroundColor:1310779,physics:{default:"arcade",arcade:{}}},tt=a(5),et=null,at=function(){return Object(i.useLayoutEffect)((function(){et=new o.a.Game($)}),[]),Object(i.useEffect)((function(){return function(){var t;null===(t=et)||void 0===t||t.destroy(!0,!0)}}),[]),Object(tt.jsx)("div",{children:Object(tt.jsx)("div",{id:"game-box"})})};var it=function(){return Object(tt.jsx)("div",{className:"App",children:Object(tt.jsx)(at,{})})};a(24);Object(n.render)(Object(tt.jsx)(it,{}),document.getElementById("root"))}},[[25,1,2]]]);
//# sourceMappingURL=main.2093275b.chunk.js.map